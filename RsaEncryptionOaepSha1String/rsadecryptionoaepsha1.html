<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>RSA 2048 encryption with OAEP padding and SHA-1 hashing (decryption only)</title>
	<style>
		body {background-color: powderblue;}
		h1 {color: blue;}
		h2 {font-size: 200%;}
		p {font-size: 150%; }
		button {height: 100%; font-size: 150%;}
		textarea {font-size: 150%;}
		input[type="text"] {font-size: 100%; }
		input[type="button"] {font-size: 100%; }
	</style>	
</head>
<body>
<h1>RSA 2048 encryption with OAEP padding and SHA-1 hashing (decryption only)</h1>
<hr>
<p><b>Important note: this program is doing what it promises but the programming itself is of very poor quality and for demonstration purposes only. Never ever use this program as source for your own programs because there are a lot of conversions to get it run.</b>
<br><br>Get more information about this program on <a href="https://github.com/java-crypto/cross_platform_crypto/blob/main/docs/rsa_decryption_oaep_sha1_string.md" target="_blank">
my webpage <b>RSA string decryption with OAEP SHA1 padding</b></a><br>
<p>Insert your own Private Key (in PEM encoding):</p>
<textarea name="privatekey-value" id="privatekey-value" form= "myform" rows="10" cols="40">-----BEGIN PRIVATE KEY-----
MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDwSZYlRn86zPi9e1RTZL7QzgE/36zjbeCMyOhf6o/WIKeVxFwVbG2FAY3YJZIxnBH+9j1XS6f+ewjGFlJY4f2IrOpS1kPiO3fmOo5N4nc8JKvjwmKtUM0t63uFFPfs69+7mKJ4w3tk2mSN4gb8J9P9BCXtH6Q78SdOYvdCMspA1X8eERsdLb/jjHs8+gepKqQ6+XwZbSq0vf2BMtaAB7zTX/Dk+ZxDfwIobShPaB0mYmojE2YAQeRq1gYdwwO1dEGk6E5J2toWPpKY/IcSYsGKyFqrsmbw0880r1BwRDer4RFrkzp4zvY+kX3eDanlyMqDLPN+ghXT1lv8snZpbaBDAgMBAAECggEBAIVxmHzjBc11/73bPB2EGaSEg5UhdzZm0wncmZCLB453XBqEjk8nhDsVfdzIIMSEVEowHijYz1c4pMq9osXR26eHwCp47AI73H5zjowadPVluEAot/xgn1IdMN/boURmSj44qiI/DcwYrTdOi2qGA+jD4PwrUl4nsxiJRZ/x7PjLhMzRbvDxQ4/Q4ThYXwoEGiIBBK/iB3Z5eR7lFa8E5yAaxM2QP9PENBr/OqkGXLWVqA/YTxs3gAvkUjMhlScOi7PMwRX9HsrAeLKbLuC1KJv1p2THUtZbOHqrAF/uwHajygUblFaa/BTckTN7PKSVIhp7OihbD04bSRrh+nOilcECgYEA/8atV5DmNxFrxF1PODDjdJPNb9pzNrDF03TiFBZWS4Q+2JazyLGjZzhg5Vv9RJ7VcIjPAbMy2Cy5BUffEFE+8ryKVWfdpPxpPYOwHCJSw4Bqqdj0Pmp/xw928ebrnUoCzdkUqYYpRWx0T7YVRoA9RiBfQiVHhuJBSDPYJPoP34kCgYEA8H9wLE5L8raUn4NYYRuUVMa+1k4Q1N3XBixm5cccc/Ja4LVvrnWqmFOmfFgpVd8BcTGaPSsqfA4j/oEQp7tmjZqggVFqiM2mJ2YEv18cY/5kiDUVYR7VWSkpqVOkgiX3lK3UkIngnVMGGFnoIBlfBFF9uo02rZpC5o5zebaDImsCgYAE9d5wv0+nq7/STBj4NwKCRUeLrsnjOqRriG3GA/TifAsX+jw8XS2VF+PRLuqHhSkQiKazGr2Wsa9Y6d7qmxjEbmGkbGJBC+AioEYvFX9TaU8oQhvihgA6ZRNid58EKuZJBbe/3ek4/nR3A0oAVwZZMNGIH972P7cSZmb/uJXMOQKBgQCsFaQAL+4sN/TUxrkAkylqF+QJmEZ26l2nrzHZjMWROYNJcsn8/XkaEhD4vGSnazCu/B0vU6nMppmezF9Mhc112YSrw8QFK5GOc3NGNBoueqMYy1MG8Xcbm1aSMKVv8xbarh+BZQbxy6x61CpCfaT9hAoA6HaNdeoU6y05lBz1DQKBgAbYiIk56QZHeoZKiZxy4eicQS0sVKKRb24ZUd+04cNSTfeIuuXZrYJ48Jbr0fzjIM3EfHvLgh9rAZ+aHe/L84Ig17KiExe+qyYHjut/SC0wODDtzM/jtrpqyYa5JoEpPIaUSgPuTH/WhO3cDsx63PIW4/CddNs8mCSBOqTnoaxh
-----END PRIVATE KEY-----</textarea>
<section class="import-key spki">
<hr>
<p>Enter a message to decrypt (in Base64 encoding):</p>
<textarea name="ciphertextBase64" id="ciphertextBase64" rows="10" cols="40">JmTdIvJp4JueoqtCZ2xlm7DNKq9qytq3KIthaWzQkWOIf3o33kr69XH48O7NS1vdnKNr1+oidiGQJ3T5P8ukn9rYsHdTNwc8qBOp+ATusHL7LVtwCzdgUx6mWr7qe8YwPZZiAIg2RCOy17jaLvVCkoR+N5euk1+qH/eQyKbYA4/DNRXyJGxOb+7xb3gFuedJWvYcvf8eWJU2kFTVaHoFEqBdG2awOfVf0KaOS16z81qyHLIFiWmUePLyu4vtr1wx/G80Xq1Bkha0K2/IhDSn8J/s/uTxyORAfUDzVmyEdmXQFYEWri1TPcD7GDNV8GBaCWWgDccfcpfIZ3pzg/lKww==</textarea>
<hr>
<p><b>Instructions:</b><br>
1.: insert your own private key and press the "Import key" button<br>
2.: if the private key is valid the "Decrypt" button is enabled<br>
3.: enter the ciphertext message in Base64 encoding<br>
4.: press the "Decrypt button"<br>
5.: receive the decrypted plaintext</p><hr>
<input class="import-key-button" type="button" value="Import Key">
<input class="decrypt-button hidden" type="button" value="Decrypt" disabled>
</section>
<p>decrypted plaintext:</p>
<textarea name="decryptedtext" id="decryptedtext" rows="1" cols="50" readonly>the decrypted plaintext comes here...</textarea>
<hr><p><b>Technical note: this program uses the RSA encryption algorithm with a 2048 bit long key, OAEP padding and SHA-1 hash algorithm.</b></p><hr>
</body>
   <SCRIPT LANGUAGE="JavaScript">
      const bufToB64 = buf =>
        btoa(Array.prototype.map.call(buf, ch => String.fromCharCode(ch)).join(""));
	const bufToStr = str => new TextDecoder().decode(str);
      const b64ToBuf = b64 => {
        const binstr = atob(b64),
          buf = new Uint8Array(binstr.length);
        Array.prototype.forEach.call(binstr, (ch, i) => {
          buf[i] = ch.charCodeAt(0);
        });
        return buf;
      };
      
        /*
        The unwrapped encryption key.
        */
		let privatekey;
      
		const decryptButton = document.querySelector(".spki .decrypt-button");
      
        /*
        Convert a string into an ArrayBuffer
        from https://developers.google.com/web/updates/2012/06/How-to-convert-ArrayBuffer-to-and-from-String
        */
        function str2ab(str) {
          const buf = new ArrayBuffer(str.length);
          const bufView = new Uint8Array(buf);
          for (let i = 0, strLen = str.length; i < strLen; i++) {
            bufView[i] = str.charCodeAt(i);
          }
          return buf;
        }
	
  /*
  Fetch the contents of the "message" textbox, and encode it
  in a form we can use for the encrypt operation.
  */
  function getMessageEncoding() {
    const messageBox = document.querySelector("#plaintext");
    const message = messageBox.value;
    const enc = new TextEncoder();
    return enc.encode(message);
  }		
		
/*
Import a PEM encoded RSA private key, to use for RSA-PSS signing.
Takes a string containing the PEM encoded key, and returns a Promise
that will resolve to a CryptoKey representing the private key.
*/
function importPrivateKey(pem) {
// fetch the part of the PEM string between header and footer
const pemHeader = "-----BEGIN PRIVATE KEY-----";
const pemFooter = "-----END PRIVATE KEY-----";
const pemContents = pem.substring(pemHeader.length, pem.length - pemFooter.length);
// base64 decode the string to get the binary data
const binaryDerString = window.atob(pemContents);
// convert from a binary string to an ArrayBuffer
const binaryDer = str2ab(binaryDerString);
return window.crypto.subtle.importKey(
	"pkcs8",
	binaryDer,
	{
		name: "RSA-OAEP",
		hash: "SHA-1"
	},
	true,
	["decrypt"]
	);
}

	async function decryptMessage() {
		let ciphertext = b64ToBuf(document.getElementById("ciphertextBase64").value);
		decryptedtext = await window.crypto.subtle.decrypt(
		{
			name: "RSA-OAEP"
		},
		privateKey,
		ciphertext
		);
		document.getElementById("decryptedtext").value = bufToStr(decryptedtext);
	}
		
        function enableDecryptButton() {
          decryptButton.classList.add('fade-in');
          decryptButton.addEventListener('animationend', () => {
            decryptButton.classList.remove('fade-in');
          });
          decryptButton.removeAttribute("disabled");
          decryptButton.classList.remove("hidden");
        }
		
        /*
        When the user clicks "Import Key"
        - import the key
        - enable the "Decrypt" button
        */
const importKeyButton = document.querySelector(".spki .import-key-button");
  importKeyButton.addEventListener("click", async () => {
	var pemEncodedKeyPriTextarea = document.getElementById("privatekey-value").value;
	privateKey = await importPrivateKey(pemEncodedKeyPriTextarea);
	enableDecryptButton();
  });
  decryptButton.addEventListener("click", decryptMessage);

</SCRIPT>	
</html>
